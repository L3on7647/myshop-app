<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Store Manager</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #F2F2F7; --primary: #007AFF; --text: #000; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 16px; margin: 0; }
        
        .segmented-control { display: flex; background: #e3e3e8; padding: 2px; border-radius: 9px; margin-bottom: 20px; }
        .tab { flex: 1; text-align: center; padding: 7px; font-size: 12px; font-weight: 600; border-radius: 7px; cursor: pointer; color: #666; }
        .tab.active { background: #FFF; color: #000; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        .section { display: none; }
        .section.active { display: block; animation: slide 0.3s; }
        
        .card { background: #FFF; padding: 16px; border-radius: 14px; margin-bottom: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        h2 { margin: 0 0 15px 0; font-size: 18px; }

        input, select { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 10px; background: #fafafa; font-size: 16px; box-sizing: border-box; }
        
        .btn { width: 100%; padding: 14px; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; color: #fff; cursor: pointer; }
        .btn-blue { background: var(--primary); }
        .btn-green { background: #34C759; }
        .btn-yellow { background: #FF9F0A; margin-bottom: 10px; }
        
        .cart-item { background: #fff; padding: 10px; margin-bottom: 5px; border-radius: 8px; border-left: 3px solid var(--primary); font-size: 14px; display:flex; justify-content:space-between;}

        @keyframes slide { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
    </style>
</head>
<body>

    <div class="segmented-control">
        <div class="tab active" onclick="sw('create')">Katalog</div>
        <div class="tab" onclick="sw('kirim')">Kirim</div>
        <div class="tab" onclick="sw('sotuv')">Sotuv</div>
        <div class="tab" onclick="sw('settings')">Sozlama</div>
    </div>

    <div id="create" class="section active">
        <div class="card">
            <h2>‚ú® Yangi Tovar</h2>
            <input type="text" id="c_name" placeholder="Nomi (Masalan: Pepsi 1.5)">
            <input type="text" id="c_brand" placeholder="Brend">
            <select id="c_cat"><option>Oziq-ovqat</option><option>Texnika</option><option>Kiyim</option><option>Boshqa</option></select>
            <select id="c_unit"><option>dona</option><option>kg</option><option>litr</option></select>
            <input type="text" id="c_country" placeholder="Davlat">
            <button class="btn btn-blue" onclick="sendCreate()">Saqlash</button>
        </div>
    </div>

    <div id="kirim" class="section">
        <div class="card">
            <h2>üì• Kirim</h2>
            <input type="text" id="k_loc" list="locs" placeholder="Sklad nomini yozing...">
            <input type="text" id="k_supplier" placeholder="Ta'minotchi">
            <hr>
            <input type="text" id="k_name" placeholder="Tovar nomi (Katalogda bo'lishi shart!)">
            <input type="number" id="k_qty" placeholder="Soni" oninput="calc('k')">
            <input type="number" id="k_total" placeholder="Jami Summa" oninput="calc('k')">
            <input type="number" id="k_price" placeholder="Dona narxi" readonly style="background:#eee">
            <button class="btn btn-yellow" onclick="add('k')">Savatga +</button>
        </div>
        <div id="list_k"></div>
        <button class="btn btn-green" onclick="submit('kirim')">Qabul Qilish</button>
    </div>

    <div id="sotuv" class="section">
        <div class="card">
            <h2>üí∏ Sotuv</h2>
            <input type="text" id="s_loc" list="locs" placeholder="Do'kon nomini yozing...">
            <input type="text" id="s_client" placeholder="Mijoz ismi">
            <hr>
            <input type="text" id="s_name" placeholder="Tovar nomi (Katalogda bo'lishi shart!)">
            <input type="number" id="s_qty" placeholder="Soni">
            <input type="number" id="s_price" placeholder="Sotuv narxi (Dona)">
            <button class="btn btn-yellow" onclick="add('s')">Savatga +</button>
        </div>
        <div id="list_s"></div>
        <div class="card">
            <label>To'lov turi</label>
            <select id="s_pay"><option>Naqd</option><option>Plastik</option><option>Nasiya</option></select>
            <input type="number" id="s_paid" placeholder="To'landi (Agar nasiya bo'lsa kam yozing)">
            <button class="btn btn-green" onclick="submit('sotuv')">Sotish</button>
        </div>
    </div>

    <div id="settings" class="section">
        <div class="card">
            <h2>‚öôÔ∏è Joylar (Sklad/Do'kon)</h2>
            <p style="color:#666; font-size:12px;">Yangi do'kon yoki sklad nomini yozib qo'shing.</p>
            <input type="text" id="new_loc_name" placeholder="Masalan: Sergeli Sklad">
            <button class="btn btn-blue" onclick="addLoc()">Joyni yaratish</button>
        </div>
    </div>

    <datalist id="locs">
        <option value="Asosiy Sklad">
        <option value="Do'kon 1">
        <option value="Do'kon 2">
    </datalist>

    <script>
        let tg = window.Telegram.WebApp; tg.expand();
        let cartK = [], cartS = [];

        function sw(id) {
            document.querySelectorAll('.section').forEach(e=>e.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(e=>e.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
        }

        function calc(p) {
            let q = parseFloat(document.getElementById(p+'_qty').value);
            let t = parseFloat(document.getElementById(p+'_total').value);
            if(q && t) document.getElementById(p+'_price').value = (t/q).toFixed(0);
        }

        function add(p) {
            let name = document.getElementById(p+'_name').value;
            let qty = parseFloat(document.getElementById(p+'_qty').value);
            let price = parseFloat(document.getElementById(p+'_price').value);
            if(!name || !qty || !price) return tg.showAlert("To'liq yozing!");
            
            let item = {name, qty, price, total: qty*price};
            if(p=='k') { cartK.push(item); render('k'); }
            else { cartS.push(item); render('s'); }
            
            document.getElementById(p+'_name').value = '';
            document.getElementById(p+'_qty').value = '';
        }

        function render(p) {
            let list = (p=='k') ? cartK : cartS;
            let el = document.getElementById('list_'+p);
            el.innerHTML = list.map(i => `<div class="cart-item"><b>${i.name}</b> <span>${i.qty} x ${i.price}</span></div>`).join('');
        }

        function addLoc() {
            let n = document.getElementById('new_loc_name').value;
            if(!n) return;
            tg.sendData(JSON.stringify({action:'add_loc', name:n}));
        }

        function sendCreate() {
            let d = {
                action:'create', name:document.getElementById('c_name').value,
                brand:document.getElementById('c_brand').value, cat:document.getElementById('c_cat').value,
                unit:document.getElementById('c_unit').value, country:document.getElementById('c_country').value
            };
            if(!d.name) return tg.showAlert("Nomini yozing");
            tg.sendData(JSON.stringify(d));
        }

        function submit(type) {
            let d = { action: type };
            if(type=='kirim') {
                d.items = cartK; d.loc = document.getElementById('k_loc').value; 
                d.supplier = document.getElementById('k_supplier').value;
                if(cartK.length==0) return tg.showAlert("Savat bo'sh");
            } else {
                d.items = cartS; d.loc = document.getElementById('s_loc').value;
                d.client = document.getElementById('s_client').value;
                d.pay_type = document.getElementById('s_pay').value;
                d.paid = document.getElementById('s_paid').value;
                if(cartS.length==0) return tg.showAlert("Savat bo'sh");
            }
            if(!d.loc) return tg.showAlert("Joy nomini yozing!");
            tg.sendData(JSON.stringify(d));
        }
    </script>
</body>
</html>
