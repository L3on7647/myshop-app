<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pro ERP</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #F2F2F7; --card: #FFF; --blue: #007AFF; --green: #34C759; --orange: #FF9500; --red: #FF3B30; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #000; padding: 15px; margin: 0; -webkit-tap-highlight-color: transparent; }
        
        /* MENU TABS */
        .tabs { display: flex; background: rgba(118, 118, 128, 0.12); padding: 2px; border-radius: 10px; margin-bottom: 20px; overflow-x: auto;}
        .tab { flex: 1; text-align: center; padding: 8px; font-size: 12px; font-weight: 600; border-radius: 8px; cursor: pointer; color: #000; min-width: 60px; }
        .tab.active { background: #FFF; box-shadow: 0 3px 8px rgba(0,0,0,0.12); }

        .form-section { display: none; }
        .form-section.active { display: block; animation: fade 0.3s; }
        .card { background: var(--card); padding: 20px; border-radius: 18px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 15px; }

        /* DASHBOARD CARDS */
        .dash-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .dash-card { background: #FFF; padding: 15px; border-radius: 16px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .dash-val { font-size: 18px; font-weight: 700; margin-top: 5px; }
        .dash-lbl { font-size: 12px; color: #888; }
        .green-txt { color: var(--green); } .red-txt { color: var(--red); } .blue-txt { color: var(--blue); }

        h3 { margin: 0 0 15px 0; font-size: 17px; }
        .group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-size: 12px; color: #8e8e93; font-weight: 600; }
        input, select, textarea { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #E5E5EA; background: #F9F9F9; font-size: 16px; box-sizing: border-box; }
        
        .btn { width: 100%; padding: 16px; border-radius: 14px; border: none; font-size: 16px; font-weight: 700; color: #FFF; margin-top: 5px; cursor: pointer; }
        .btn-add { background: var(--blue); } .btn-in { background: var(--green); } .btn-out { background: var(--red); } .btn-refresh { background: var(--orange); }

        @keyframes fade { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="tabs">
        <div class="tab active" onclick="sw('home')">üè† Asosiy</div>
        <div class="tab" onclick="sw('create')">‚ûï Yangi</div>
        <div class="tab" onclick="sw('kirim')">üì• Kirim</div>
        <div class="tab" onclick="sw('sotuv')">üì§ Sotuv</div>
    </div>

    <div id="home" class="form-section active">
        <div class="dash-grid">
            <div class="dash-card">
                <div class="dash-lbl">Bugungi Savdo</div>
                <div class="dash-val blue-txt" id="d_sales">0 UZS</div>
            </div>
            <div class="dash-card">
                <div class="dash-lbl">Sof Foyda</div>
                <div class="dash-val green-txt" id="d_profit">0 UZS</div>
            </div>
            <div class="dash-card">
                <div class="dash-lbl">Nasiyalar</div>
                <div class="dash-val red-txt" id="d_debt">0 UZS</div>
            </div>
            <div class="dash-card">
                <div class="dash-lbl">Kassadagi Pul</div>
                <div class="dash-val" id="d_cash">0 UZS</div>
            </div>
        </div>
        <button class="btn btn-refresh" onclick="send('get_stats')">üîÑ Yangilash</button>
    </div>

    <div id="create" class="form-section">
        <div class="card">
            <h3>‚ú® Tovar Pasporti</h3>
            <div class="group"><label>Nomi</label><input type="text" id="new_name" placeholder="Masalan: iPhone 15"></div>
            <div class="group"><label>Brend</label><input type="text" id="new_brand" placeholder="Apple..."></div>
            <div class="group"><label>Kategoriya</label><input type="text" id="new_cat" placeholder="Texnika..."></div>
            <div class="group"><label>O'lchov</label>
                <select id="new_unit"><option>dona</option><option>kg</option><option>litr</option><option>metr</option></select>
            </div>
            <button class="btn btn-add" onclick="send('create')">Saqlash</button>
        </div>
    </div>

    <div id="kirim" class="form-section">
        <div class="card">
            <h3>üì• Omborga Kirim</h3>
            <div class="group"><label>Sklad/Do'kon</label>
                <select id="in_loc"><option>Asosiy Sklad</option><option>Do'kon 1</option><option>Do'kon 2</option></select>
            </div>
            <div class="group"><label>Yetkazib beruvchi (Ta'minotchi)</label><input type="text" id="in_client" placeholder="Kimdan oldik?"></div>
            <div class="group"><label>Tovar Nomi</label><input type="text" id="in_name" placeholder="Nima keldi?"></div>
            <div class="group"><label>Soni</label><input type="number" id="in_qty" placeholder="0"></div>
            <div class="group"><label>Kelish Narxi (Dona)</label><input type="number" id="in_price" placeholder="Summa"></div>
            <button class="btn btn-in" onclick="send('kirim')">Qabul Qilish</button>
        </div>
    </div>

    <div id="sotuv" class="form-section">
        <div class="card">
            <h3>üí∏ Sotuv / Kassa</h3>
            <div class="group"><label>Qayerdan?</label>
                <select id="out_loc"><option>Do'kon 1</option><option>Do'kon 2</option><option>Asosiy Sklad</option></select>
            </div>
            
            <div class="group"><label>Mijoz (Ismi yoki Tel)</label>
                <input type="text" id="out_client" placeholder="Noma'lum mijoz">
            </div>

            <div class="group"><label>Tovar Nomi</label><input type="text" id="out_name"></div>
            <div class="group"><label>Soni</label><input type="number" id="out_qty"></div>
            
            <div class="group"><label>Sotish Narxi (JAMI)</label><input type="number" id="out_price" placeholder="Jami summa"></div>
            
            <div class="group"><label>Qancha to'ladi? (Nasiya uchun)</label>
                <input type="number" id="out_paid" placeholder="Agar bo'sh qolsa, to'liq to'landi deb olinadi">
            </div>

            <div class="group"><label>Sana</label><input type="date" id="out_date"></div>

            <button class="btn btn-out" onclick="send('sotuv')">Sotish</button>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp; tg.expand();
        tg.setHeaderColor('#F2F2F7'); tg.setBackgroundColor('#F2F2F7');
        
        document.getElementById('out_date').valueAsDate = new Date();

        function sw(id) {
            document.querySelectorAll('.form-section').forEach(e=>e.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(e=>e.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
        }

        function send(act) {
            tg.HapticFeedback.impactOccurred('medium');
            let d = { a: act };

            if(act === 'create') {
                d.name = v('new_name'); d.brand = v('new_brand'); d.cat = v('new_cat'); d.unit = v('new_unit');
                if(!d.name) return err();
            }
            else if(act === 'kirim') {
                d.loc = v('in_loc'); d.client = v('in_client'); d.name = v('in_name'); 
                d.qty = v('in_qty'); d.price = v('in_price');
                if(!d.name || !d.qty) return err();
            }
            else if(act === 'sotuv') {
                d.loc = v('out_loc'); d.client = v('out_client'); d.name = v('out_name'); 
                d.qty = v('out_qty'); d.price = v('out_price'); d.paid = v('out_paid'); d.date = v('out_date');
                if(!d.name || !d.qty || !d.price) return err();
            }

            tg.sendData(JSON.stringify(d));
        }

        function v(id) { return document.getElementById(id).value; }
        function err() { tg.showAlert("Ma'lumotlarni to'ldiring!"); return false; }
    </script>
</body>
</html>
